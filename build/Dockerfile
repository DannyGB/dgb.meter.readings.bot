FROM golang:1.19.1

RUN mkdir /app

COPY . /app

WORKDIR /app/cmd/meter.readings.bot

ARG HTTP_PORT=80
ENV METER_READINGS_TELEGRAM_BOT_HTTP_PORT $HTTP_PORT

ARG TELEGRAM_BOT_TOKEN
ENV METER_READINGS_TELEGRAM_BOT_TOKEN $TELEGRAM_BOT_TOKEN

ARG TELEGRAM_VALID_USERS
ENV METER_READINGS_TELEGRAM_VALID_USERS: $TELEGRAM_VALID_USERS

ARG MONGO_COLLECTION
ENV METER_READINGS_MONGO_COLLECTION: $MONGO_COLLECTION

ARG MONGO_DB
ENV METER_READINGS_MONGO_DB: $MONGO_DB

ARG MONGO_CONNECTION
ENV METER_READINGS_MONGO_CONNECTION: $MONGO_CONNECTION

RUN go build -o meter.readings.bot .

CMD [ "/app/cmd/meter.readings.bot/meter.readings.bot" ]
